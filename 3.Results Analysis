## Libraries
import pandas as pd
import numpy as np
import re
from IPython.display import display
import matplotlib.pyplot as plt
from matplotlib.patches import Ellipse
import warnings
import math
import seaborn as sns


## Data entry and processing

file_paths = [
    'C:/Users/alham/Desktop/Main Simulation folders/Gina Krog/Gina Krog_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Grane/Grane_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Gullfaks/Gullfaks_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Heidrun/Heidrun_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Johan Sverdrup/Johan_Sverdrup_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Kristin Tyrihans/Kristin_Tyrihans_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Martin Linge/Martin Linge_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Njord/Njord_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Norne/Norne_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Oseberg/Oseberg_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Sleipner/Sleipner_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Snorre/Snorre_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Statfjord/Statfjord_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Troll/Troll_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Valemon/Valemon_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Vigdis/Vigdis_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Visund/Visund_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Åsgard/Åsgard_Final_Database.xlsx',
    'C:/Users/alham/Desktop/Main Simulation folders/Aasta Hansteen/Aasta Hansteen_Final_Database.xlsx',
]

dfs = []

for file in file_paths:
    df = pd.read_excel(file, usecols=range(33))
    dfs.append(df)

concatenated_df = pd.concat(dfs, ignore_index=True)

raw_df = concatenated_df
raw_df['Relative error']= (((raw_df['Gauge pressure'] - raw_df['Pressure']) / raw_df['Gauge pressure']).abs())
raw_df['Deviation']= raw_df['Gauge pressure'] - raw_df['Pressure']
raw_df['Deviation']= raw_df['Gauge pressure'] - raw_df['Pressure']
raw_df['Correlation'] = raw_df['Correlation'].replace('Hydro 3P 19 Hydro3P', 'Hydro 3P', regex=False)


raw_df['well test index'] = np.repeat(range(len(raw_df) // 19 + 1), 19)[:len(raw_df)]
raw_df['well test index'] = np.repeat(range(1, len(raw_df) // 19 + 2), 19)[:len(raw_df)]

indices_to_remove = raw_df[raw_df['Relative error'] > 1]['well test index'].unique()
raw_df = raw_df[~raw_df['well test index'].isin(indices_to_remove)]


correlation_list=['Duns and Ross Modified', 'Hagedorn and Brown', 'Fancher and Brown', 'Mukerjee - Brill',
 'Beggs and Brill', 'Petroleum Experts', 'Orkizewski', 'Petroleum Experts 2', 'Duns and Ross Original', 
 'Petroleum Experts 3', 'GRE (Modified by PE)', 'Petroleum Experts 4', 'Hydro 3P', 'Petroleum Experts 5', 
 'Hydro-2P', 'PE 5 (Extended)', 'OLGAS 2P', 'OLGAS 3P', 'OLGAS3P EXT']


## Array

pd.set_option('display.max_columns',None)
pd.set_option('display.max_rows',None)
#pd.reset_option('display.max_columns')
pd.reset_option('display.max_rows')
raw_df


## MAPE-WAPE-MAD-SD Calculation
results_df = pd.DataFrame(columns=['Correlation', 'MAPE', 'WAPE', 'MAD', 'SD'])  

for correlation in correlation_list:
    filtered_df = raw_df[raw_df['Correlation'] == correlation]

    sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
    count_rows = len(filtered_df)
    MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

    sum_deviations = filtered_df['Deviation'].abs().sum()
    sum_GP = filtered_df['Gauge pressure'].sum()
    WAPE = sum_deviations / sum_GP if sum_GP else float('inf')  
    MAD = sum_deviations / count_rows if count_rows else float('inf')  
    SD = filtered_df['Deviation'].std()

    result = pd.DataFrame([[correlation, MAPE, WAPE, MAD, SD]], columns=['Correlation', 'MAPE', 'WAPE', 'MAD', 'SD'])
    results_df = pd.concat([results_df, result], ignore_index=True)

results_df['MAPE'] *= 100
results_df['WAPE'] *= 100

display(results_df)
## MAPE Plot
bar_colors = ['#DCDCDC'] * len(results_df)  
min_mape_correlation = results_df.loc[results_df['MAPE'].idxmin(), 'Correlation']
max_mape_correlation = results_df.loc[results_df['MAPE'].idxmax(), 'Correlation']
results_df.sort_values('MAPE', inplace=True)
min_mape_position = results_df[results_df['Correlation'] == min_mape_correlation].index[0]
max_mape_position = results_df[results_df['Correlation'] == max_mape_correlation].index[0]
for ix, correlation in enumerate(results_df['Correlation']):
    if correlation == min_mape_correlation:
        bar_colors[ix] = '#4682B4'  
    if correlation == max_mape_correlation:
        bar_colors[ix] = '#B22222'  

plt.figure(figsize=(10, 8))

bars = plt.bar(results_df['Correlation'], results_df['MAPE'], color=bar_colors)
plt.errorbar(results_df['Correlation'], results_df['MAPE'], yerr=results_df['SD'] * 0.03, fmt='none', capsize=5, color='black')
plt.xticks(rotation=90, ha="right")
for label in plt.gca().get_xticklabels():
    if label.get_text() == min_mape_correlation:
        label.set_fontweight('bold')

plt.title('Overall performance of the different correlations')
plt.xlabel('Correlation')
plt.ylabel('MAPE (%)')
plt.tight_layout()
plt.show()
## Analysis of Fluid Impact 
results_df = pd.DataFrame(columns=['Correlation', 'Fluid type', 'MAPE', 'WAPE', 'MAD', 'SD'])
fluid_types = ['Oil', 'Gas', 'Retrograde Condensate']
Best_ones = []

for correlation in correlation_list:
    for fluid_type in fluid_types:
        filtered_df = raw_df[(raw_df['Correlation'] == correlation) & (raw_df['Fluid type'] == fluid_type)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  

            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'Fluid type': [fluid_type], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for fluid_type in fluid_types:
    fluid_df = results_df[results_df['Fluid type'] == fluid_type]
    
    if not fluid_df.empty:
        best_correlation_row = fluid_df.loc[fluid_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for fluid_type in fluid_types:
    display_df = results_df[results_df['Fluid type'] == fluid_type]
    print(display_df)
## Fluid Impact - Format 1
neutral_color = '#DCDCDC'   
best_case_color = '#4682B4'  
worst_case_color = '#F08080'  

scale_factor_for_sd = 1  

fluid_types = ['Oil', 'Gas', 'Retrograde Condensate']
for fluid_type in fluid_types:
    df_filtered = results_df[results_df['Fluid type'] == fluid_type].copy()

    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

 
    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors)
    plt.xticks(rotation=45, ha='right')
    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({fluid_type})')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')   
    ax.tick_params(axis='y', labelcolor='C0')
    sd_values_scaled = df_filtered['SD'] * scale_factor_for_sd 
    ax2 = ax.twinx()
    ax2.set_ylabel('Scaled SD', color='C3')  
    sd_line = ax2.plot(df_filtered['Correlation'], sd_values_scaled, 'o-', color='C3')
    ax2.tick_params(axis='y', labelcolor='C3')
    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Fluid Impact - Format 2
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05

for fluid_type in fluid_types:
    df_filtered = results_df[results_df['Fluid type'] == fluid_type].copy()

    df_filtered.sort_values('MAPE', ascending=True, inplace=True)

    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']

    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
        else (worst_case_color if x == worst_case_correlation
              else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    num_test_points = raw_df[raw_df['Fluid type'] == fluid_type]['Correlation'].count()
    ax.text(0.01, 0.95, f'Number of test points: {num_test_points}', transform=ax.transAxes,
            fontsize=10, verticalalignment='top')

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f"Correlations' performance in {fluid_type} wells")
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Fluid Impact - Format 3

colors = {
    'Oil': '#A9A9A9',  
    'Gas': '#F08080',  
    'Retrograde Condensate': '#4682B4'  
}

unique_correlations = results_df['Correlation'].unique()
unique_fluid_types = results_df['Fluid type'].unique()
num_groups = len(unique_correlations)
bar_width = 0.2 


plt.figure(figsize=(15, 7))
ax = plt.subplot(111)
offset = np.arange(num_groups)

for i, fluid_type in enumerate(unique_fluid_types):
    df_filtered = results_df[results_df['Fluid type'] == fluid_type]
    ordered_mape = df_filtered.set_index('Correlation').reindex(unique_correlations)['MAPE']
    bar_positions = offset + (i * bar_width)
    ax.bar(bar_positions, ordered_mape, width=bar_width, color=colors[fluid_type], label=fluid_type)

for bar in ax.patches: 
    bar.set_alpha(0.65)


for best_idx, (fluid_type, best_corr) in enumerate(zip(unique_fluid_types, Best_ones)):
    corr_index = np.where(unique_correlations == best_corr)[0][0]  
    x_position = offset[corr_index] + (best_idx * bar_width)  
    bar_height = results_df[(results_df['Fluid type'] == fluid_type) & (results_df['Correlation'] == best_corr)]['MAPE'].values[0]   
    contrast_color = 'black'
    ellipse = Ellipse((x_position, bar_height/2), width=3*bar_width, height=1.2*bar_height, edgecolor=contrast_color, facecolor='none', color=colors[fluid_type], fill=False, lw=2, linestyle='--', zorder=10)
    ax.add_artist(ellipse)



ax.set_xticks(offset + bar_width / 2 * (len(unique_fluid_types) - 1))
ax.set_xticklabels(unique_correlations, rotation=45, ha='right')

plt.legend(title='Fluid type')
plt.title('MAPE for Different Correlations by Fluid Type')
plt.xlabel('Correlation')
plt.ylabel('MAPE (%)')
plt.tight_layout()
plt.show()
## Analysis of Production Ratios: GOR

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['GOR'] = raw_df['GOR'].replace('Nan', np.nan) 
df_GOR_tuned = raw_df[raw_df['GOR'].notna()]

GOR_min=df_GOR_tuned['GOR'].min()
GOR_max=df_GOR_tuned['GOR'].max()
GOR_full_span=GOR_max-GOR_min
GOR_span=GOR_full_span/3
GOR_bound_low=GOR_min+GOR_span
GOR_bound_medium=GOR_min+(2*GOR_span)
print(GOR_min)
print(GOR_min+GOR_span)
print(GOR_min+2*GOR_span)

print(GOR_max)

GOR_min = int(GOR_min)
GOR_bound_low = int(GOR_bound_low)
GOR_bound_medium = int(GOR_bound_medium)
GOR_max = int(GOR_max)

GOR_min = int(GOR_min)
GOR_bound_low = 1000
GOR_bound_medium = 5000
GOR_max = int(GOR_max)

df_GOR_tuned.loc[(df_GOR_tuned['GOR'] >= GOR_min) & (df_GOR_tuned['GOR'] < GOR_bound_low), 'GOR range'] = 'Low'
df_GOR_tuned.loc[(df_GOR_tuned['GOR'] >= GOR_bound_low) & (df_GOR_tuned['GOR'] < GOR_bound_medium), 'GOR range'] = 'Medium'
df_GOR_tuned['GOR range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'GOR Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
GOR_Ranges=['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for GOR_Range in GOR_Ranges:
        filtered_df = df_GOR_tuned[(df_GOR_tuned['Correlation'] == correlation) & (df_GOR_tuned['GOR range'] == GOR_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'GOR Range': [GOR_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for GOR_Range in GOR_Ranges:
    GOR_df = results_df[results_df['GOR Range'] == GOR_Range]
    
    if not GOR_df.empty:
        best_correlation_row = GOR_df.loc[GOR_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for GOR_Range in GOR_Ranges:
    display_df = results_df[results_df['GOR Range'] == GOR_Range]
    print(display_df)
## GOR Impact
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import warnings


neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05

results_df['Test Points'] = None 
GOR_Ranges = ['Low', 'Medium', 'High']

range_dict = {
    'Low': (GOR_min, GOR_bound_low),
    'Medium': (GOR_bound_low, GOR_bound_medium),
    'High': (GOR_bound_medium, GOR_max)
}

for GOR_Range in GOR_Ranges:
    df_filtered = results_df[results_df['GOR Range'] == GOR_Range].copy()

    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f"Correlations' accuracy in {GOR_Range} GOR wells")
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')  
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_GOR_tuned[df_GOR_tuned['GOR range'] == GOR_Range].shape[0]
    ax.text(0.01, 0.95, f"Test points: {num_test_points}",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    ax.text(0.01, 0.90, f"GOR Span: {range_dict[GOR_Range][0]} - {range_dict[GOR_Range][1]} [Sm3/Sm3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Analysis of Production Ratios: CGR

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['CGR'] = raw_df['CGR'].replace('Nan', np.nan) 
df_CGR_tuned = raw_df[raw_df['CGR'].notna()]

CGR_min=df_CGR_tuned['CGR'].min()
CGR_max=df_CGR_tuned['CGR'].max()
CGR_full_span=CGR_max-CGR_min
CGR_span=CGR_full_span/30
CGR_bound_low=CGR_min+(10*CGR_span)
CGR_bound_medium=CGR_min+(20*CGR_span)

CGR_min = CGR_min
CGR_bound_low = CGR_bound_low
CGR_bound_medium = CGR_bound_medium
CGR_max = CGR_max

CGR_min = CGR_min
CGR_bound_low = 2e-07
CGR_bound_medium = 2e-06
CGR_max = CGR_max
2e-05
print(CGR_min)
print(CGR_max)

df_CGR_tuned.loc[(df_CGR_tuned['CGR'] >= CGR_min) & (df_CGR_tuned['CGR'] < CGR_bound_low), 'CGR range'] = 'Low'
df_CGR_tuned.loc[(df_CGR_tuned['CGR'] >= CGR_bound_low) & (df_CGR_tuned['CGR'] < CGR_bound_medium), 'CGR range'] = 'Medium'
df_CGR_tuned['CGR range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'CGR Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
CGR_Ranges=['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for CGR_Range in CGR_Ranges:
        filtered_df = df_CGR_tuned[(df_CGR_tuned['Correlation'] == correlation) & (df_CGR_tuned['CGR range'] == CGR_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'CGR Range': [CGR_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for CGR_Range in CGR_Ranges:
    CGR_df = results_df[results_df['CGR Range'] == CGR_Range]
    
    if not CGR_df.empty:
        best_correlation_row = CGR_df.loc[CGR_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for CGR_Range in CGR_Ranges:
    display_df = results_df[results_df['CGR Range'] == CGR_Range]
    print(display_df)
## CGR Impact
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import warnings


neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05

CGR_Ranges = ['Low', 'Medium', 'High']
range_dict = {
    'Low': (CGR_min, CGR_bound_low),
    'Medium': (CGR_bound_low, CGR_bound_medium),
    'High': (CGR_bound_medium, CGR_max)
}

results_df['Test Points'] = None 
for CGR_Range in CGR_Ranges:
    results_df.loc[results_df['CGR Range'] == CGR_Range, 'Test Points'] = df_CGR_tuned[df_CGR_tuned['CGR range'] == CGR_Range].shape[0]
    results_df.loc[results_df['CGR Range'] == CGR_Range, 'CGR Range Span'] = f"{range_dict[CGR_Range][0]:.2e} - {range_dict[CGR_Range][1]:.2e}"

for CGR_Range in CGR_Ranges:
    df_filtered = results_df[results_df['CGR Range'] == CGR_Range].copy()

    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f"Correlations' accuracy in {CGR_Range} CGR wells")
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')  
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_CGR_tuned[df_CGR_tuned['CGR range'] == CGR_Range].shape[0]
    ax.text(0.01, 0.95, f"Test points: {num_test_points}",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    ax.text(0.01, 0.90, f"CGR Span: {range_dict[CGR_Range][0]:.2e} - {range_dict[CGR_Range][1]:.2e} [Sm3/Sm3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Analysis of Production Ratios: WGR

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['WGR'] = raw_df['WGR'].replace('Nan', np.nan) 
df_WGR_tuned = raw_df[raw_df['WGR'].notna()]

WGR_min=df_WGR_tuned['WGR'].min()
WGR_max=df_WGR_tuned['WGR'].max()
WGR_full_span=WGR_max-WGR_min
WGR_span=WGR_full_span/3
WGR_bound_low=WGR_min+(1*WGR_span)
WGR_bound_medium=WGR_min+(2*WGR_span)

WGR_min = WGR_min
WGR_bound_low = WGR_bound_low
WGR_bound_medium = WGR_bound_medium
WGR_max = WGR_max

WGR_min = WGR_min
WGR_bound_low = 3e-5
WGR_bound_medium = 1e-4
WGR_max = WGR_max

print(WGR_min)
print(WGR_max)

df_WGR_tuned.loc[(df_WGR_tuned['WGR'] >= WGR_min) & (df_WGR_tuned['WGR'] < WGR_bound_low), 'WGR range'] = 'Low'
df_WGR_tuned.loc[(df_WGR_tuned['WGR'] >= WGR_bound_low) & (df_WGR_tuned['WGR'] < WGR_bound_medium), 'WGR range'] = 'Medium'
df_WGR_tuned['WGR range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'WGR Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
WGR_Ranges=['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for WGR_Range in WGR_Ranges:
        filtered_df = df_WGR_tuned[(df_WGR_tuned['Correlation'] == correlation) & (df_WGR_tuned['WGR range'] == WGR_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'WGR Range': [WGR_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for WGR_Range in WGR_Ranges:
    WGR_df = results_df[results_df['WGR Range'] == WGR_Range]
    
    if not WGR_df.empty:
        best_correlation_row = WGR_df.loc[WGR_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for WGR_Range in WGR_Ranges:
    display_df = results_df[results_df['WGR Range'] == WGR_Range]
    print(display_df)
## WGR Impact
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import warnings


neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05

WGR_Ranges = ['Low', 'Medium', 'High']
range_dict = {
    'Low': (WGR_min, WGR_bound_low),
    'Medium': (WGR_bound_low, WGR_bound_medium),
    'High': (WGR_bound_medium, WGR_max)
}

results_df['Test Points'] = None 
for WGR_Range in WGR_Ranges:
    results_df.loc[results_df['WGR Range'] == WGR_Range, 'Test Points'] = df_WGR_tuned[df_WGR_tuned['WGR range'] == WGR_Range].shape[0]
    results_df.loc[results_df['WGR Range'] == WGR_Range, 'WGR Range Span'] = f"{range_dict[WGR_Range][0]:.2e} - {range_dict[WGR_Range][1]:.2e}"

for WGR_Range in WGR_Ranges:
    df_filtered = results_df[results_df['WGR Range'] == WGR_Range].copy()

    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f"Correlations' accuracy in {WGR_Range} WGR wells")
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')  
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_WGR_tuned[df_WGR_tuned['WGR range'] == WGR_Range].shape[0]
    ax.text(0.01, 0.95, f"Test points: {num_test_points}",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    ax.text(0.01, 0.90, f"WGR Span: {range_dict[WGR_Range][0]:.2e} - {range_dict[WGR_Range][1]:.2e} [Sm3/Sm3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Analysis of the Liquid rate
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['liquid_rate'] = raw_df['liquid_rate'].replace('Nan', np.nan)  
df_liquid_rate_tuned = raw_df[raw_df['liquid_rate'].notna()]

liquid_rate_min = df_liquid_rate_tuned['liquid_rate'].min()
liquid_rate_max = df_liquid_rate_tuned['liquid_rate'].max()
liquid_rate_full_span = liquid_rate_max - liquid_rate_min
liquid_rate_span = liquid_rate_full_span / 3
liquid_rate_bound_low = liquid_rate_min + (1 * liquid_rate_span)
liquid_rate_bound_medium = liquid_rate_min + (2 * liquid_rate_span)


liquid_rate_bound_low = 400
liquid_rate_bound_medium = 1500



df_liquid_rate_tuned.loc[(df_liquid_rate_tuned['liquid_rate'] >= liquid_rate_min) & (df_liquid_rate_tuned['liquid_rate'] < liquid_rate_bound_low), 'liquid_rate range'] = 'Low'
df_liquid_rate_tuned.loc[(df_liquid_rate_tuned['liquid_rate'] >= liquid_rate_bound_low) & (df_liquid_rate_tuned['liquid_rate'] < liquid_rate_bound_medium), 'liquid_rate range'] = 'Medium'
df_liquid_rate_tuned['liquid_rate range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'liquid_rate Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
liquid_rate_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for liquid_rate_Range in liquid_rate_Ranges:
        filtered_df = df_liquid_rate_tuned[(df_liquid_rate_tuned['Correlation'] == correlation) & (df_liquid_rate_tuned['liquid_rate range'] == liquid_rate_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'liquid_rate Range': [liquid_rate_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for liquid_rate_Range in liquid_rate_Ranges:
    liquid_rate_df = results_df[results_df['liquid_rate Range'] == liquid_rate_Range]
    
    if not liquid_rate_df.empty:
        best_correlation_row = liquid_rate_df.loc[liquid_rate_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for liquid_rate_Range in liquid_rate_Ranges:
    display_df = results_df[results_df['liquid_rate Range'] == liquid_rate_Range]
    print(display_df)  
## Liquid rate Impact
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import warnings


neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05

liquid_rate_Ranges = ['Low', 'Medium', 'High']
range_dict = {
    'Low': (liquid_rate_min, liquid_rate_bound_low),
    'Medium': (liquid_rate_bound_low, liquid_rate_bound_medium),
    'High': (liquid_rate_bound_medium, liquid_rate_max)
}

results_df['Test Points'] = None  
for liquid_rate_Range in liquid_rate_Ranges:
    results_df.loc[results_df['liquid_rate Range'] == liquid_rate_Range, 'Test Points'] = df_liquid_rate_tuned[df_liquid_rate_tuned['liquid_rate range'] == liquid_rate_Range].shape[0]
    results_df.loc[results_df['liquid_rate Range'] == liquid_rate_Range, 'liquid_rate Range Span'] = f"{range_dict[liquid_rate_Range][0]:.2e} - {range_dict[liquid_rate_Range][1]:.2e}"

for liquid_rate_Range in liquid_rate_Ranges:
    df_filtered = results_df[results_df['liquid_rate Range'] == liquid_rate_Range].copy()

    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f"Correlations' accuracy in {liquid_rate_Range} liquid rate wells")
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')  
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_liquid_rate_tuned[df_liquid_rate_tuned['liquid_rate range'] == liquid_rate_Range].shape[0]
    ax.text(0.01, 0.95, f"Test points: {num_test_points}",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    ax.text(0.01, 0.90, f"liquid rate Span: {range_dict[liquid_rate_Range][0]:.2e} - {range_dict[liquid_rate_Range][1]:.2e} [Sm3/day]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Analysis of the Gas rate
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['Gas rate'] = raw_df['Gas rate'].replace('Nan', np.nan)  
df_Gas_rate_tuned = raw_df[raw_df['Gas rate'].notna()]

Gas_rate_min = df_Gas_rate_tuned['Gas rate'].min()
Gas_rate_max = df_Gas_rate_tuned['Gas rate'].max()
Gas_rate_full_span = Gas_rate_max - Gas_rate_min
Gas_rate_span = Gas_rate_full_span / 3
Gas_rate_bound_low = Gas_rate_min + (1 * Gas_rate_span)
print(Gas_rate_bound_low)
Gas_rate_bound_medium = Gas_rate_min + (2 * Gas_rate_span)
print('low')
print(Gas_rate_min)
print(Gas_rate_min+Gas_rate_span)
print(Gas_rate_min+2*Gas_rate_span)



Gas_rate_bound_low = 400
Gas_rate_bound_medium = 1500


print(Gas_rate_max)
df_Gas_rate_tuned.loc[(df_Gas_rate_tuned['Gas rate'] >= Gas_rate_min) & (df_Gas_rate_tuned['Gas rate'] < Gas_rate_bound_low), 'Gas_rate range'] = 'Low'
df_Gas_rate_tuned.loc[(df_Gas_rate_tuned['Gas rate'] >= Gas_rate_bound_low) & (df_Gas_rate_tuned['Gas rate'] < Gas_rate_bound_medium), 'Gas_rate range'] = 'Medium'
df_Gas_rate_tuned['Gas_rate range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'Gas_rate Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
Gas_rate_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for Gas_rate_Range in Gas_rate_Ranges:
        filtered_df = df_Gas_rate_tuned[(df_Gas_rate_tuned['Correlation'] == correlation) & (df_Gas_rate_tuned['Gas_rate range'] == Gas_rate_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'Gas_rate Range': [Gas_rate_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for Gas_rate_Range in Gas_rate_Ranges:
    Gas_rate_df = results_df[results_df['Gas_rate Range'] == Gas_rate_Range]
    
    if not Gas_rate_df.empty:
        best_correlation_row = Gas_rate_df.loc[Gas_rate_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for Gas_rate_Range in Gas_rate_Ranges:
    display_df = results_df[results_df['Gas_rate Range'] == Gas_rate_Range]
    print(display_df)  
## Gas rate Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
Gas_rate_Ranges = ['Low', 'Medium', 'High']

for Gas_rate_Range in Gas_rate_Ranges:
    df_filtered = results_df[results_df['Gas_rate Range'] == Gas_rate_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
        else (worst_case_color if x == worst_case_correlation
              else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    
    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)
    
    plt.xticks(rotation=45, ha='right')

    ax.set_title(f"Correlations' accuracy in {Gas_rate_Range} gas rate Range")
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_Gas_rate_tuned[df_Gas_rate_tuned['Gas_rate range'] == Gas_rate_Range].shape[0]

    Gas_rate_min_range = df_Gas_rate_tuned[df_Gas_rate_tuned['Gas_rate range'] == Gas_rate_Range]['Gas rate'].min()
    Gas_rate_max_range = df_Gas_rate_tuned[df_Gas_rate_tuned['Gas_rate range'] == Gas_rate_Range]['Gas rate'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Gas rate Span: {Gas_rate_min_range:.2f} - {Gas_rate_max_range:.2f} [1000 Sm3/day]", transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    
    plt.show()
## Analysis of the Bottom hole Temperature
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['Temperature'] = raw_df['Temperature'].replace('Nan', np.nan)  
df_Temperature_tuned = raw_df[raw_df['Temperature'].notna()]

Temperature_min = df_Temperature_tuned['Temperature'].min()
Temperature_max = df_Temperature_tuned['Temperature'].max()
Temperature_full_span = Temperature_max - Temperature_min
Temperature_span = Temperature_full_span / 3
Temperature_bound_low = Temperature_min + (1 * Temperature_span)
Temperature_bound_medium = Temperature_min + (2 * Temperature_span)


df_Temperature_tuned.loc[(df_Temperature_tuned['Temperature'] >= Temperature_min) & (df_Temperature_tuned['Temperature'] < Temperature_bound_low), 'Temperature range'] = 'Low'
df_Temperature_tuned.loc[(df_Temperature_tuned['Temperature'] >= Temperature_bound_low) & (df_Temperature_tuned['Temperature'] < Temperature_bound_medium), 'Temperature range'] = 'Medium'
df_Temperature_tuned['Temperature range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'Temperature Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
Temperature_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for Temperature_Range in Temperature_Ranges:
        filtered_df = df_Temperature_tuned[(df_Temperature_tuned['Correlation'] == correlation) & (df_Temperature_tuned['Temperature range'] == Temperature_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'Temperature Range': [Temperature_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for Temperature_Range in Temperature_Ranges:
    Temperature_df = results_df[results_df['Temperature Range'] == Temperature_Range]
    
    if not Temperature_df.empty:
        best_correlation_row = Temperature_df.loc[Temperature_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for Temperature_Range in Temperature_Ranges:
    display_df = results_df[results_df['Temperature Range'] == Temperature_Range]
    print(display_df)  
## Temperature Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
Temperature_Ranges = ['Low', 'Medium', 'High']

for Temperature_Range in Temperature_Ranges:
    df_filtered = results_df[results_df['Temperature Range'] == Temperature_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    
    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    
    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({Temperature_Range} Temperature)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_Temperature_tuned[df_Temperature_tuned['Temperature range'] == Temperature_Range].shape[0]
    
    Temperature_min_range = df_Temperature_tuned[df_Temperature_tuned['Temperature range'] == Temperature_Range]['Temperature'].min()
    Temperature_max_range = df_Temperature_tuned[df_Temperature_tuned['Temperature range'] == Temperature_Range]['Temperature'].max()
    
    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Temperature Span: {int(Temperature_min_range)} - {int(Temperature_max_range)} [°C]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    
    # Show the plot
    plt.show()
## Analysis of the Water cut
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['water_cut'] = raw_df['water_cut'].replace('Nan', np.nan) 
df_water_cut_tuned = raw_df[raw_df['water_cut'].notna()]

water_cut_min = df_water_cut_tuned['water_cut'].min()
water_cut_max = df_water_cut_tuned['water_cut'].max()
water_cut_full_span = water_cut_max - water_cut_min
water_cut_span = water_cut_full_span / 3
water_cut_bound_low = water_cut_min + (1 * water_cut_span)
print(water_cut_bound_low)
water_cut_bound_medium = water_cut_min + (2 * water_cut_span)
print(water_cut_bound_medium)
water_cut_bound_low =25
water_cut_bound_medium =70 


df_water_cut_tuned.loc[(df_water_cut_tuned['water_cut'] >= water_cut_min) & (df_water_cut_tuned['water_cut'] < water_cut_bound_low), 'water_cut range'] = 'Low'
df_water_cut_tuned.loc[(df_water_cut_tuned['water_cut'] >= water_cut_bound_low) & (df_water_cut_tuned['water_cut'] < water_cut_bound_medium), 'water_cut range'] = 'Medium'
df_water_cut_tuned['water_cut range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'water_cut Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
water_cut_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for water_cut_Range in water_cut_Ranges:
        filtered_df = df_water_cut_tuned[(df_water_cut_tuned['Correlation'] == correlation) & (df_water_cut_tuned['water_cut range'] == water_cut_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'water_cut Range': [water_cut_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for water_cut_Range in water_cut_Ranges:
    water_cut_df = results_df[results_df['water_cut Range'] == water_cut_Range]
    
    if not water_cut_df.empty:
        best_correlation_row = water_cut_df.loc[water_cut_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for water_cut_Range in water_cut_Ranges:
    display_df = results_df[results_df['water_cut Range'] == water_cut_Range]
    print(display_df)  
## Water cut Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
water_cut_Ranges = ['Low', 'Medium', 'High']

for water_cut_Range in water_cut_Ranges:
    df_filtered = results_df[results_df['water_cut Range'] == water_cut_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)

    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({water_cut_Range} water cut)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')  
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_water_cut_tuned[df_water_cut_tuned['water_cut range'] == water_cut_Range].shape[0]

    water_cut_min_range = df_water_cut_tuned[df_water_cut_tuned['water_cut range'] == water_cut_Range]['water_cut'].min()
    water_cut_max_range = df_water_cut_tuned[df_water_cut_tuned['water_cut range'] == water_cut_Range]['water_cut'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"water cut Span: {water_cut_min_range:.1f} - {water_cut_max_range:.1f} [%]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Density analysis: Oil
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['oil density'] = raw_df['oil density'].replace('Nan', np.nan) 
df_oil_density_tuned = raw_df[raw_df['oil density'].notna()]

oil_density_min = df_oil_density_tuned['oil density'].min()
oil_density_max = df_oil_density_tuned['oil density'].max()
oil_density_full_span = oil_density_max - oil_density_min
oil_density_span = oil_density_full_span / 3
oil_density_bound_low = oil_density_min + oil_density_span
oil_density_bound_medium = oil_density_min + (2 * oil_density_span)

oil_density_min = int(oil_density_min)
oil_density_bound_low = int(oil_density_bound_low)
oil_density_bound_medium = int(oil_density_bound_medium)
oil_density_max = int(oil_density_max)

oil_density_bound_low = 600
oil_density_bound_medium = 800

df_oil_density_tuned.loc[(df_oil_density_tuned['oil density'] >= oil_density_min) & (df_oil_density_tuned['oil density'] < oil_density_bound_low), 'oil density range'] = 'Low'
df_oil_density_tuned.loc[(df_oil_density_tuned['oil density'] >= oil_density_bound_low) & (df_oil_density_tuned['oil density'] < oil_density_bound_medium), 'oil density range'] = 'Medium'
df_oil_density_tuned['oil density range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'oil density Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
oil_density_Ranges=['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for oil_density_Range in oil_density_Ranges:
        filtered_df = df_oil_density_tuned[(df_oil_density_tuned['Correlation'] == correlation) & (df_oil_density_tuned['oil density range'] == oil_density_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'oil density Range': [oil_density_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for oil_density_Range in oil_density_Ranges:
    oil_density_df = results_df[results_df['oil density Range'] == oil_density_Range]
    
    if not oil_density_df.empty:
        best_correlation_row = oil_density_df.loc[oil_density_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for oil_density_Range in oil_density_Ranges:
    display_df = results_df[results_df['oil density Range'] == oil_density_Range]
    print(display_df)
## Oil density Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
oil_density_Ranges = ['Low', 'Medium', 'High']

for oil_density_Range in oil_density_Ranges:
    df_filtered = results_df[results_df['oil density Range'] == oil_density_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({oil_density_Range} Oil Density)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_oil_density_tuned[df_oil_density_tuned['oil density range'] == oil_density_Range].shape[0]
    
    oil_density_min_range = df_oil_density_tuned[df_oil_density_tuned['oil density range'] == oil_density_Range]['oil density'].min()
    oil_density_max_range = df_oil_density_tuned[df_oil_density_tuned['oil density range'] == oil_density_Range]['oil density'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Oil Density Span: {oil_density_min_range:.1f} - {oil_density_max_range:.1f} [kg/m3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Density analysis: Gas
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['gas density'] = raw_df['gas density'].replace('Nan', np.nan) 
df_gas_density_tuned = raw_df[raw_df['gas density'].notna()]

gas_density_min = df_gas_density_tuned['gas density'].min()
gas_density_max = df_gas_density_tuned['gas density'].max()
gas_density_full_span = gas_density_max - gas_density_min
gas_density_span = gas_density_full_span / 3
gas_density_bound_low = gas_density_min + gas_density_span
gas_density_bound_medium = gas_density_min + (2 * gas_density_span)

gas_density_min = int(gas_density_min)
gas_density_bound_low = int(gas_density_bound_low)
gas_density_bound_medium = int(gas_density_bound_medium)
gas_density_max = int(gas_density_max)

df_gas_density_tuned.loc[(df_gas_density_tuned['gas density'] >= gas_density_min) & (df_gas_density_tuned['gas density'] < gas_density_bound_low), 'gas density range'] = 'Low'
df_gas_density_tuned.loc[(df_gas_density_tuned['gas density'] >= gas_density_bound_low) & (df_gas_density_tuned['gas density'] < gas_density_bound_medium), 'gas density range'] = 'Medium'
df_gas_density_tuned['gas density range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'gas density Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
gas_density_Ranges=['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for gas_density_Range in gas_density_Ranges:
        filtered_df = df_gas_density_tuned[(df_gas_density_tuned['Correlation'] == correlation) & (df_gas_density_tuned['gas density range'] == gas_density_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'gas density Range': [gas_density_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for gas_density_Range in gas_density_Ranges:
    gas_density_df = results_df[results_df['gas density Range'] == gas_density_Range]
    
    if not gas_density_df.empty:
        best_correlation_row = gas_density_df.loc[gas_density_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for gas_density_Range in gas_density_Ranges:
    display_df = results_df[results_df['gas density Range'] == gas_density_Range]
    print(display_df)
## Gas density Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
gas_density_Ranges = ['Low', 'Medium', 'High']

for gas_density_Range in gas_density_Ranges:
    df_filtered = results_df[results_df['gas density Range'] == gas_density_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()  
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')
    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({gas_density_Range} Gas Density)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_gas_density_tuned[df_gas_density_tuned['gas density range'] == gas_density_Range].shape[0]
    
    gas_density_min_range = df_gas_density_tuned[df_gas_density_tuned['gas density range'] == gas_density_Range]['gas density'].min()
    gas_density_max_range = df_gas_density_tuned[df_gas_density_tuned['gas density range'] == gas_density_Range]['gas density'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Gas Density Span: {gas_density_min_range:.1e} - {gas_density_max_range:.1e} [kg/m3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Density analysis: Liquid
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['liquid density'] = raw_df['liquid density'].replace('Nan', np.nan)  
df_liquid_density_tuned = raw_df[raw_df['liquid density'].notna()]

liquid_density_min = df_liquid_density_tuned['liquid density'].min()
liquid_density_max = df_liquid_density_tuned['liquid density'].max()
liquid_density_full_span = liquid_density_max - liquid_density_min
liquid_density_span = liquid_density_full_span / 3
liquid_density_bound_low = liquid_density_min + liquid_density_span
liquid_density_bound_medium = liquid_density_min + (2 * liquid_density_span)

liquid_density_min = int(liquid_density_min)
liquid_density_bound_low = int(liquid_density_bound_low)
liquid_density_bound_medium = int(liquid_density_bound_medium)
liquid_density_max = int(liquid_density_max)

df_liquid_density_tuned.loc[(df_liquid_density_tuned['liquid density'] >= liquid_density_min) & (df_liquid_density_tuned['liquid density'] < liquid_density_bound_low), 'liquid density range'] = 'Low'
df_liquid_density_tuned.loc[(df_liquid_density_tuned['liquid density'] >= liquid_density_bound_low) & (df_liquid_density_tuned['liquid density'] < liquid_density_bound_medium), 'liquid density range'] = 'Medium'
df_liquid_density_tuned['liquid density range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'liquid density Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
liquid_density_Ranges=['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for liquid_density_Range in liquid_density_Ranges:
        filtered_df = df_liquid_density_tuned[(df_liquid_density_tuned['Correlation'] == correlation) & (df_liquid_density_tuned['liquid density range'] == liquid_density_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'liquid density Range': [liquid_density_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for liquid_density_Range in liquid_density_Ranges:
    liquid_density_df = results_df[results_df['liquid density Range'] == liquid_density_Range]
    
    if not liquid_density_df.empty:
        best_correlation_row = liquid_density_df.loc[liquid_density_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for liquid_density_Range in liquid_density_Ranges:
    display_df = results_df[results_df['liquid density Range'] == liquid_density_Range]
    print(display_df)
## Liquid density Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
liquid_density_Ranges = ['Low', 'Medium', 'High']

for liquid_density_Range in liquid_density_Ranges:
    df_filtered = results_df[results_df['liquid density Range'] == liquid_density_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation 
        else (worst_case_color if x == worst_case_correlation 
              else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()

    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)
    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({liquid_density_Range} Liquid Density)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_liquid_density_tuned[df_liquid_density_tuned['liquid density range'] == liquid_density_Range].shape[0]
    
    liquid_density_min_range = df_liquid_density_tuned[df_liquid_density_tuned['liquid density range'] == liquid_density_Range]['liquid density'].min()
    liquid_density_max_range = df_liquid_density_tuned[df_liquid_density_tuned['liquid density range'] == liquid_density_Range]['liquid density'].max()
    
    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Liquid Density Span: {liquid_density_min_range:.1e} - {liquid_density_max_range:.1e} [kg/m3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show()  
## Density analysis: Water
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)


raw_df['water density'] = raw_df['water density'].replace('Nan', np.nan) 
df_water_density_tuned = raw_df[raw_df['water density'].notna()]

water_density_min = df_water_density_tuned['water density'].min()
water_density_max = df_water_density_tuned['water density'].max()
water_density_full_span = water_density_max - water_density_min
water_density_span = water_density_full_span/2
water_density_bound_low = water_density_min + water_density_span

water_density_min = int(water_density_min)
water_density_bound_low = int(water_density_bound_low)
water_density_max = int(water_density_max)

water_density_bound_low = 950


df_water_density_tuned.loc[(df_water_density_tuned['water density'] >= water_density_min) & (df_water_density_tuned['water density'] < water_density_bound_low), 'water density range'] = 'Low'
df_water_density_tuned['water density range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'water density Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
water_density_Ranges=['Low', 'High']
Best_ones = []

for correlation in correlation_list:
    for water_density_Range in water_density_Ranges:
        filtered_df = df_water_density_tuned[(df_water_density_tuned['Correlation'] == correlation) & (df_water_density_tuned['water density range'] == water_density_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'water density Range': [water_density_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for water_density_Range in water_density_Ranges:
    water_density_df = results_df[results_df['water density Range'] == water_density_Range]
    
    if not water_density_df.empty:
        
        best_correlation_row = water_density_df.loc[water_density_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for water_density_Range in water_density_Ranges:
    display_df = results_df[results_df['water density Range'] == water_density_Range]
    print(display_df)
## Water density Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
water_density_Ranges = ['Low', 'High']

for water_density_Range in water_density_Ranges:
    df_filtered = results_df[results_df['water density Range'] == water_density_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
        else (worst_case_color if x == worst_case_correlation
              else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()

    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)
    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({water_density_Range} Water Density)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_water_density_tuned[df_water_density_tuned['water density range'] == water_density_Range].shape[0]
    
    if water_density_Range == 'Low':
        water_density_min_range = df_water_density_tuned[df_water_density_tuned['water density range'] == water_density_Range]['water density'].min()
        water_density_max_range = water_density_bound_low
    else:
        water_density_min_range = water_density_bound_low
        water_density_max_range = df_water_density_tuned[df_water_density_tuned['water density range'] == water_density_Range]['water density'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Water Density Span: {water_density_min_range:.1f} - {water_density_max_range:.1f} [kg/m3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show() 
## Density analysis: Mixture
import pandas as pd
import numpy as np
import warnings

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['mixture density'] = raw_df['mixture density'].replace('Nan', np.nan) 
df_mixture_density_tuned = raw_df[raw_df['mixture density'].notna()]

mixture_density_min = df_mixture_density_tuned['mixture density'].min()
mixture_density_max = df_mixture_density_tuned['mixture density'].max()
mixture_density_full_span = mixture_density_max - mixture_density_min
mixture_density_span = mixture_density_full_span / 3
mixture_density_bound_low = mixture_density_min + mixture_density_span
mixture_density_bound_medium = mixture_density_min + (2 * mixture_density_span)

mixture_density_min = int(mixture_density_min)
mixture_density_bound_low = int(mixture_density_bound_low)
mixture_density_bound_medium = int(mixture_density_bound_medium)
mixture_density_max = int(mixture_density_max)

df_mixture_density_tuned.loc[(df_mixture_density_tuned['mixture density'] >= mixture_density_min) & (df_mixture_density_tuned['mixture density'] < mixture_density_bound_low), 'mixture density range'] = 'Low'
df_mixture_density_tuned.loc[(df_mixture_density_tuned['mixture density'] >= mixture_density_bound_low) & (df_mixture_density_tuned['mixture density'] < mixture_density_bound_medium), 'mixture density range'] = 'Medium'
df_mixture_density_tuned['mixture density range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'Mixture Density Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
mixture_density_ranges = ['Low', 'Medium', 'High']
best_ones = []

for correlation in correlation_list:
    for mixture_density_range in mixture_density_ranges:
        filtered_df = df_mixture_density_tuned[(df_mixture_density_tuned['Correlation'] == correlation) & (df_mixture_density_tuned['mixture density range'] == mixture_density_range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation],
                                       'Mixture Density Range': [mixture_density_range],
                                       'MAPE': [MAPE * 100],
                                       'WAPE': [WAPE * 100],
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for mixture_density_range in mixture_density_ranges:
    mixture_density_df = results_df[results_df['Mixture Density Range'] == mixture_density_range]

    if not mixture_density_df.empty:
        best_correlation_row = mixture_density_df.loc[mixture_density_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        best_ones.append((best_correlation_name))

for mixture_density_range in mixture_density_ranges:
    display_df = results_df[results_df['Mixture Density Range'] == mixture_density_range]
    print(display_df)
## Mixture density Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
mixture_density_Ranges = ['Low', 'Medium', 'High']

for mixture_density_Range in mixture_density_Ranges:
    df_filtered = results_df[results_df['Mixture Density Range'] == mixture_density_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
        else (worst_case_color if x == worst_case_correlation
              else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()

    ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors, 
           yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)
    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({mixture_density_Range} Mixture Density)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_mixture_density_tuned[df_mixture_density_tuned['mixture density range'] == mixture_density_Range].shape[0]
    
    mixture_density_min_range = df_mixture_density_tuned[df_mixture_density_tuned['mixture density range'] == mixture_density_Range]['mixture density'].min()
    mixture_density_max_range = df_mixture_density_tuned[df_mixture_density_tuned['mixture density range'] == mixture_density_Range]['mixture density'].max()
    
    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Mixture Density Span: {mixture_density_min_range:.1e} - {mixture_density_max_range:.1e} [kg/m3]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show() 
## Holdup Analysis

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['Holdup'] = raw_df['Holdup'].replace('Nan', np.nan)  
df_Holdup_tuned = raw_df[raw_df['Holdup'].notna()]

Holdup_min = df_Holdup_tuned['Holdup'].min()
Holdup_max = df_Holdup_tuned['Holdup'].max()
Holdup_full_span = Holdup_max - Holdup_min
Holdup_span = Holdup_full_span / 3
Holdup_bound_low = Holdup_min + Holdup_span
Holdup_bound_medium = Holdup_min + (2 * Holdup_span)

Holdup_min = Holdup_min
Holdup_bound_low = Holdup_bound_low
Holdup_bound_medium = Holdup_bound_medium
Holdup_max = Holdup_max


print(Holdup_min)
print(Holdup_max)
df_Holdup_tuned.loc[(df_Holdup_tuned['Holdup'] >= Holdup_min) & (df_Holdup_tuned['Holdup'] < Holdup_bound_low), 'Holdup Range'] = 'Low'
df_Holdup_tuned.loc[(df_Holdup_tuned['Holdup'] >= Holdup_bound_low) & (df_Holdup_tuned['Holdup'] < Holdup_bound_medium), 'Holdup Range'] = 'Medium'
df_Holdup_tuned['Holdup Range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'Holdup Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
Holdup_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for Holdup_Range in Holdup_Ranges:
        filtered_df = df_Holdup_tuned[(df_Holdup_tuned['Correlation'] == correlation) & (df_Holdup_tuned['Holdup Range'] == Holdup_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'Holdup Range': [Holdup_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for Holdup_Range in Holdup_Ranges:
    Holdup_df = results_df[results_df['Holdup Range'] == Holdup_Range]
    
    if not Holdup_df.empty:
        best_correlation_row = Holdup_df.loc[Holdup_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for Holdup_Range in Holdup_Ranges:
    display_df = results_df[results_df['Holdup Range'] == Holdup_Range]
    print(display_df)
## Holdup Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
Holdup_Ranges = ['Low', 'Medium', 'High']

for Holdup_Range in Holdup_Ranges:
    df_filtered = results_df[results_df['Holdup Range'] == Holdup_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']

    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({Holdup_Range} Holdup)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_Holdup_tuned[df_Holdup_tuned['Holdup Range'] == Holdup_Range].shape[0]

    Holdup_min_range = df_Holdup_tuned[df_Holdup_tuned['Holdup Range'] == Holdup_Range]['Holdup'].min()
    Holdup_max_range = df_Holdup_tuned[df_Holdup_tuned['Holdup Range'] == Holdup_Range]['Holdup'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Holdup Span: {Holdup_min_range:.2f} - {Holdup_max_range:.2f}",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show() 
## Analysis of the Tubing diameter
import warnings
import pandas as pd

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['diameter'] = raw_df['diameter'].replace('Nan', np.nan)  
df_diameter_tuned = raw_df[raw_df['diameter'].notna()]

diameter_min = df_diameter_tuned['diameter'].min()
diameter_max = df_diameter_tuned['diameter'].max()
diameter_full_span = diameter_max - diameter_min
diameter_span = diameter_full_span / 3
diameter_bound_low = diameter_min + diameter_span
diameter_bound_medium = diameter_min + (2 * diameter_span)

diameter_min = diameter_min
diameter_bound_low = diameter_bound_low
diameter_bound_medium = diameter_bound_medium
diameter_max = diameter_max

diameter_bound_low = 4
diameter_bound_medium = 7
diameter_max = 32

df_diameter_tuned.loc[(df_diameter_tuned['diameter'] >= diameter_min) & (df_diameter_tuned['diameter'] < diameter_bound_low), 'diameter Range'] = 'Low'
df_diameter_tuned.loc[(df_diameter_tuned['diameter'] >= diameter_bound_low) & (df_diameter_tuned['diameter'] < diameter_bound_medium), 'diameter Range'] = 'Medium'
df_diameter_tuned['diameter Range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'diameter Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
diameter_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for diameter_Range in diameter_Ranges:
        filtered_df = df_diameter_tuned[(df_diameter_tuned['Correlation'] == correlation) & (df_diameter_tuned['diameter Range'] == diameter_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'diameter Range': [diameter_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for diameter_Range in diameter_Ranges:
    diameter_df = results_df[results_df['diameter Range'] == diameter_Range]
    
    if not diameter_df.empty:
        best_correlation_row = diameter_df.loc[diameter_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for diameter_Range in diameter_Ranges:
    display_df = results_df[results_df['diameter Range'] == diameter_Range]
    print(display_df)
## Tubing diameter impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
diameter_Ranges = ['Low', 'Medium', 'High']

for diameter_Range in diameter_Ranges:
    df_filtered = results_df[results_df['diameter Range'] == diameter_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({diameter_Range} Diameter)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_diameter_tuned[df_diameter_tuned['diameter Range'] == diameter_Range].shape[0]

    diameter_min_range = df_diameter_tuned[df_diameter_tuned['diameter Range'] == diameter_Range]['diameter'].min()
    diameter_max_range = df_diameter_tuned[df_diameter_tuned['diameter Range'] == diameter_Range]['diameter'].max()

    if diameter_Range== 'High':
        ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
        ax.text(0.01, 0.90, f"Diameter Span: {diameter_min_range:.1f} - {32.0} [inches]",
                transform=ax.transAxes, fontsize=12, verticalalignment='top')
        
    else:
        ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
        ax.text(0.01, 0.90, f"Diameter Span: {diameter_min_range:.1f} - {diameter_max_range:.1f} [inches]",
                transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show()  
## Viscosity analysis: Oil

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['oil viscosity'] = raw_df['oil viscosity'].replace('Nan', np.nan) 
df_oil_viscosity_tuned = raw_df[raw_df['oil viscosity'].notna()]

oil_viscosity_min = df_oil_viscosity_tuned['oil viscosity'].min()
oil_viscosity_max = df_oil_viscosity_tuned['oil viscosity'].max()
oil_viscosity_full_span = oil_viscosity_max - oil_viscosity_min
oil_viscosity_span = oil_viscosity_full_span / 3
oil_viscosity_bound_low = oil_viscosity_min + oil_viscosity_span
oil_viscosity_bound_medium = oil_viscosity_min + (2 * oil_viscosity_span)

oil_viscosity_min = oil_viscosity_min
oil_viscosity_bound_low = oil_viscosity_bound_low
oil_viscosity_bound_medium = oil_viscosity_bound_medium
oil_viscosity_max = oil_viscosity_max

oil_viscosity_bound_low = 5e-1
oil_viscosity_bound_medium = 1

df_oil_viscosity_tuned.loc[(df_oil_viscosity_tuned['oil viscosity'] >= oil_viscosity_min) & (df_oil_viscosity_tuned['oil viscosity'] < oil_viscosity_bound_low), 'oil viscosity Range'] = 'Low'
df_oil_viscosity_tuned.loc[(df_oil_viscosity_tuned['oil viscosity'] >= oil_viscosity_bound_low) & (df_oil_viscosity_tuned['oil viscosity'] < oil_viscosity_bound_medium), 'oil viscosity Range'] = 'Medium'
df_oil_viscosity_tuned['oil viscosity Range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'oil viscosity Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
oil_viscosity_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for oil_viscosity_Range in oil_viscosity_Ranges:
        filtered_df = df_oil_viscosity_tuned[(df_oil_viscosity_tuned['Correlation'] == correlation) & (df_oil_viscosity_tuned['oil viscosity Range'] == oil_viscosity_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'oil viscosity Range': [oil_viscosity_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for oil_viscosity_Range in oil_viscosity_Ranges:
    oil_viscosity_df = results_df[results_df['oil viscosity Range'] == oil_viscosity_Range]
    
    if not oil_viscosity_df.empty:
        best_correlation_row = oil_viscosity_df.loc[oil_viscosity_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for oil_viscosity_Range in oil_viscosity_Ranges:
    display_df = results_df[results_df['oil viscosity Range'] == oil_viscosity_Range]
    print(display_df)
## Oil Viscosity impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
oil_viscosity_Ranges = ['Low', 'Medium', 'High']

for oil_viscosity_Range in oil_viscosity_Ranges:
    df_filtered = results_df[results_df['oil viscosity Range'] == oil_viscosity_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']

    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({oil_viscosity_Range} Oil Viscosity)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_oil_viscosity_tuned[df_oil_viscosity_tuned['oil viscosity Range'] == oil_viscosity_Range].shape[0]

    oil_viscosity_min_range = df_oil_viscosity_tuned[df_oil_viscosity_tuned['oil viscosity Range'] == oil_viscosity_Range]['oil viscosity'].min()
    oil_viscosity_max_range = df_oil_viscosity_tuned[df_oil_viscosity_tuned['oil viscosity Range'] == oil_viscosity_Range]['oil viscosity'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Oil Viscosity Span: {oil_viscosity_min_range:.1e} - {oil_viscosity_max_range:.1e} [cp]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Viscosity analysis: Gas

warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['gas viscosity'] = raw_df['gas viscosity'].replace('Nan', np.nan)  
df_gas_viscosity_tuned = raw_df[raw_df['gas viscosity'].notna()]

gas_viscosity_min = df_gas_viscosity_tuned['gas viscosity'].min()
gas_viscosity_max = df_gas_viscosity_tuned['gas viscosity'].max()
gas_viscosity_full_span = gas_viscosity_max - gas_viscosity_min
gas_viscosity_span = gas_viscosity_full_span / 3
gas_viscosity_bound_low = gas_viscosity_min + gas_viscosity_span
gas_viscosity_bound_medium = gas_viscosity_min + (2 * gas_viscosity_span)

gas_viscosity_min = gas_viscosity_min
gas_viscosity_bound_low = gas_viscosity_bound_low
gas_viscosity_bound_medium = gas_viscosity_bound_medium
gas_viscosity_max = gas_viscosity_max


df_gas_viscosity_tuned.loc[(df_gas_viscosity_tuned['gas viscosity'] >= gas_viscosity_min) & (df_gas_viscosity_tuned['gas viscosity'] < gas_viscosity_bound_low), 'gas viscosity Range'] = 'Low'
df_gas_viscosity_tuned.loc[(df_gas_viscosity_tuned['gas viscosity'] >= gas_viscosity_bound_low) & (df_gas_viscosity_tuned['gas viscosity'] < gas_viscosity_bound_medium), 'gas viscosity Range'] = 'Medium'
df_gas_viscosity_tuned['gas viscosity Range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'gas viscosity Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
gas_viscosity_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for gas_viscosity_Range in gas_viscosity_Ranges:
        filtered_df = df_gas_viscosity_tuned[(df_gas_viscosity_tuned['Correlation'] == correlation) & (df_gas_viscosity_tuned['gas viscosity Range'] == gas_viscosity_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()  
            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'gas viscosity Range': [gas_viscosity_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD], 
                                       'SD': [SD]})  

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for gas_viscosity_Range in gas_viscosity_Ranges:
    gas_viscosity_df = results_df[results_df['gas viscosity Range'] == gas_viscosity_Range]
    
    if not gas_viscosity_df.empty:
        best_correlation_row = gas_viscosity_df.loc[gas_viscosity_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for gas_viscosity_Range in gas_viscosity_Ranges:
    display_df = results_df[results_df['gas viscosity Range'] == gas_viscosity_Range]
    print(display_df)
## Gas Viscosity impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
gas_viscosity_Ranges = ['Low', 'Medium', 'High']

for gas_viscosity_Range in gas_viscosity_Ranges:
    df_filtered = results_df[results_df['gas viscosity Range'] == gas_viscosity_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']

    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({gas_viscosity_Range} Gas Viscosity)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_gas_viscosity_tuned[df_gas_viscosity_tuned['gas viscosity Range'] == gas_viscosity_Range].shape[0]

    gas_viscosity_min_range = df_gas_viscosity_tuned[df_gas_viscosity_tuned['gas viscosity Range'] == gas_viscosity_Range]['gas viscosity'].min()
    gas_viscosity_max_range = df_gas_viscosity_tuned[df_gas_viscosity_tuned['gas viscosity Range'] == gas_viscosity_Range]['gas viscosity'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Gas Viscosity Span: {gas_viscosity_min_range:.1e} - {gas_viscosity_max_range:.1e} [cp]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show()  
## Pressure loss analysis
results_df = pd.DataFrame(columns=['Correlation', 'MAPE', 'dp_friction_perc', 'dp_gravity_perc'])  

for correlation in correlation_list:
    filtered_df = raw_df[raw_df['Correlation'] == correlation]

    filtered_df = filtered_df[filtered_df['dp_gravity'] >= 0]

    filtered_df['dp_friction_%']=filtered_df['dp_friction']/(filtered_df['dp_friction']+filtered_df['dp_gravity'])
    sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
    count_rows = len(filtered_df)
    MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')
    dp_friction = filtered_df['dp_friction_%'].abs().sum()
    dp_friction_perc = (dp_friction /count_rows if sum_GP else float('inf'))*100
    dp_gravity_perc = 100 -dp_friction_perc

    result = pd.DataFrame([[correlation, MAPE, dp_friction_perc, dp_gravity_perc]], columns=['Correlation', 'MAPE', 'dp_friction_perc', 'dp_gravity_perc'])
    results_df = pd.concat([results_df, result], ignore_index=True)

results_df['MAPE'] *= 100


display(results_df)
## Pressure loss Impact
bar_width = 0.8
friction_heights =  (results_df['dp_friction_perc'] )
gravity_heights =  (results_df['dp_gravity_perc'] )
bar_positions = np.arange(len(results_df))
plt.figure(figsize=(10, 8))

bars_friction = plt.bar(bar_positions, friction_heights, bar_width, color='#B22222', label='Friction Percentage')
bars_gravity = plt.bar(bar_positions, gravity_heights, bar_width, bottom=friction_heights, color='#4682B4', label='Gravity Percentage')

plt.xticks(bar_positions, results_df['Correlation'].astype(str), rotation=90, ha="right")

plt.title('Pressure loss distribution')
plt.xlabel('Correlation')
plt.ylabel('Pressure loss distribution %')
plt.legend()
plt.tight_layout()
plt.show()
## Inclination analysis
import numpy as np

raw_df['Inclination']=(raw_df['Gauge depth']-raw_df['Gauge TVD'])/raw_df['Gauge depth']
inclination_min = raw_df['Inclination'].min()
inclination_max = raw_df['Inclination'].max()
inclination_full_span = inclination_max - inclination_min
inclination_span = inclination_full_span / 3

inclination_bound_low = inclination_min + inclination_span
inclination_bound_medium = inclination_min + (2 * inclination_span)

raw_df['Inclination Range'] = pd.cut(raw_df['Inclination'], 
                                      bins=[inclination_min, inclination_bound_low, inclination_bound_medium, inclination_max], 
                                      labels=['Low', 'Medium', 'High'], 
                                      include_lowest=True)

results_df = pd.DataFrame(columns=['Correlation', 'Inclination Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
inclination_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for inclination_Range in inclination_Ranges:
        filtered_df = raw_df[(raw_df['Correlation'] == correlation) & (raw_df['Inclination Range'] == inclination_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()

            result_row = pd.DataFrame({'Correlation': [correlation], 
                                       'Inclination Range': [inclination_Range], 
                                       'MAPE': [MAPE * 100],  
                                       'WAPE': [WAPE * 100],  
                                       'MAD': [MAD],
                                       'SD': [SD]})
            results_df = pd.concat([results_df, result_row], ignore_index=True)

for inclination_Range in inclination_Ranges:
    inclination_df = results_df[results_df['Inclination Range'] == inclination_Range]
    if not inclination_df.empty:
        best_correlation_row = inclination_df.loc[inclination_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for inclination_Range in inclination_Ranges:
    display_df = results_df[results_df['Inclination Range'] == inclination_Range]
    print(display_df)

## Inclination Impact
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
inclination_Ranges = ['Low', 'Medium', 'High']

for inclination_Range in inclination_Ranges:
    df_filtered = results_df[results_df['Inclination Range'] == inclination_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']

    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
                  else (worst_case_color if x == worst_case_correlation
                        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({inclination_Range} Inclination Range)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')
    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = raw_df[raw_df['Inclination Range'] == inclination_Range].shape[0]
    inclination_min_range = raw_df[raw_df['Inclination Range'] == inclination_Range]['Inclination'].min()
    inclination_max_range = raw_df[raw_df['Inclination Range'] == inclination_Range]['Inclination'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"Inclination Span: {100*inclination_min_range:.0f} - {100*inclination_max_range:.0f} [%]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == best_case_correlation or label.get_text() == worst_case_correlation:
            label.set_fontweight('bold')

    plt.tight_layout()  
    plt.show()
## Relative viscosity analysis: Oil
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['OVC'] = ( raw_df['oil viscosity'] - raw_df['WH oil viscosity'] ) / raw_df['oil viscosity']
raw_df = raw_df[raw_df['OVC'] >= -1]
df_OVC = raw_df
OVC_min = df_OVC['OVC'].min()
OVC_max = df_OVC['OVC'].max()
OVC_full_span = OVC_max - OVC_min
OVC_span = OVC_full_span / 6
OVC_bound_low = OVC_min + OVC_span
OVC_bound_medium = OVC_min + (5 * OVC_span)

print(OVC_min)
print(OVC_max)
OVC_min = OVC_min
OVC_bound_low = OVC_bound_low
OVC_bound_medium = OVC_bound_medium
OVC_max = OVC_max

OVC_min = OVC_min
OVC_bound_low = 0
OVC_bound_medium = 0.4
OVC_max = OVC_max

df_OVC['OVC range'] = 'High' 
df_OVC.loc[(df_OVC['OVC'] >= OVC_min) & (df_OVC['OVC'] < OVC_bound_low), 'OVC range'] = 'Low'
df_OVC.loc[(df_OVC['OVC'] >= OVC_bound_low) & (df_OVC['OVC'] < OVC_bound_medium), 'OVC range'] = 'Medium'
#df_OVC['OVC range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'OVC Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
OVC_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for OVC_Range in OVC_Ranges:
        filtered_df = df_OVC[(df_OVC['Correlation'] == correlation) & (df_OVC['OVC range'] == OVC_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation],
                                       'OVC Range': [OVC_Range],
                                       'MAPE': [MAPE * 100],
                                       'WAPE': [WAPE * 100],
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for OVC_Range in OVC_Ranges:
    OVC_df = results_df[results_df['OVC Range'] == OVC_Range]

    if not OVC_df.empty:
        best_correlation_row = OVC_df.loc[OVC_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for OVC_Range in OVC_Ranges:
    display_df = results_df[results_df['OVC Range'] == OVC_Range]
    print(display_df)
## Relative viscosity Impact : Oil
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
OVC_Ranges = ['Low', 'Medium', 'High']

for OVC_Range in OVC_Ranges:
    df_filtered = results_df[results_df['OVC Range'] == OVC_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
        else (worst_case_color if x == worst_case_correlation
        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({OVC_Range} OVC)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_OVC[df_OVC['OVC range'] == OVC_Range].shape[0]

    OVC_min_range = df_OVC[df_OVC['OVC range'] == OVC_Range]['OVC'].min()
    OVC_max_range = df_OVC[df_OVC['OVC range'] == OVC_Range]['OVC'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"OVC Span: {OVC_min_range:.1f} - {OVC_max_range:.1f} [cp]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == str(best_case_correlation) or label.get_text() == str(worst_case_correlation):
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Relative viscosity analysis: Gas
warnings.simplefilter(action='ignore', category=FutureWarning)
warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

raw_df['GVC'] = ( raw_df['gas viscosity']- raw_df['WH gas viscosity']) / raw_df['gas viscosity']
raw_df = raw_df[raw_df['GVC'] >= -1]

df_GVC = raw_df
GVC_min = df_GVC['GVC'].min()
GVC_max = df_GVC['GVC'].max()
GVC_full_span = GVC_max - GVC_min
GVC_span = GVC_full_span / 6
GVC_bound_low = GVC_min + GVC_span
GVC_bound_medium = GVC_min + (5 * GVC_span)


print(GVC_min)
print(GVC_max)
GVC_min = GVC_min
GVC_bound_low = GVC_bound_low
GVC_bound_medium = GVC_bound_medium
GVC_max = GVC_max

GVC_bound_low = 0.2
GVC_bound_medium =0.6

df_GVC.loc[(df_GVC['GVC'] > GVC_bound_medium), 'GVC range'] = 'High'
df_GVC.loc[(df_GVC['GVC'] >= GVC_min) & (df_GVC['GVC'] < GVC_bound_low), 'GVC range'] = 'Low'
df_GVC.loc[(df_GVC['GVC'] >= GVC_bound_low) & (df_GVC['GVC'] < GVC_bound_medium), 'GVC range'] = 'Medium'
#df_GVC['GVC range'].fillna('High', inplace=True)

results_df = pd.DataFrame(columns=['Correlation', 'GVC Range', 'MAPE', 'WAPE', 'MAD', 'SD'])
GVC_Ranges = ['Low', 'Medium', 'High']
Best_ones = []

for correlation in correlation_list:
    for GVC_Range in GVC_Ranges:
        filtered_df = df_GVC[(df_GVC['Correlation'] == correlation) & (df_GVC['GVC range'] == GVC_Range)]

        if not filtered_df.empty:
            sum_abs_relative_error = filtered_df['Relative error'].abs().sum()
            count_rows = len(filtered_df)
            MAPE = sum_abs_relative_error / count_rows if count_rows else float('inf')

            sum_deviations = filtered_df['Deviation'].abs().sum()
            sum_GP = filtered_df['Gauge pressure'].sum()
            WAPE = sum_deviations / sum_GP if sum_GP else float('inf')
            MAD = sum_deviations / count_rows if count_rows else float('inf')
            SD = filtered_df['Deviation'].std()
            result_row = pd.DataFrame({'Correlation': [correlation],
                                       'GVC Range': [GVC_Range],
                                       'MAPE': [MAPE * 100],
                                       'WAPE': [WAPE * 100],
                                       'MAD': [MAD],
                                       'SD': [SD]})

            results_df = pd.concat([results_df, result_row], ignore_index=True)

for GVC_Range in GVC_Ranges:
    GVC_df = results_df[results_df['GVC Range'] == GVC_Range]

    if not GVC_df.empty:
        best_correlation_row = GVC_df.loc[GVC_df['MAPE'].idxmin()]
        best_correlation_name = best_correlation_row['Correlation']
        Best_ones.append((best_correlation_name))

for GVC_Range in GVC_Ranges:
    display_df = results_df[results_df['GVC Range'] == GVC_Range]
    print(display_df)
## Relative viscosity Impact : Gas
import matplotlib.pyplot as plt

neutral_color = '#DCDCDC'
best_case_color = '#4682B4'
worst_case_color = '#F08080'
scale_factor_for_sd = 0.05
GVC_Ranges = ['Low', 'Medium', 'High']

for GVC_Range in GVC_Ranges:
    df_filtered = results_df[results_df['GVC Range'] == GVC_Range].copy()
    df_filtered.sort_values('MAPE', ascending=True, inplace=True)
    best_case_correlation = df_filtered.iloc[0]['Correlation']
    worst_case_correlation = df_filtered.iloc[-1]['Correlation']
    
    bar_colors = df_filtered['Correlation'].apply(
        lambda x: best_case_color if x == best_case_correlation
        else (worst_case_color if x == worst_case_correlation
        else neutral_color)).tolist()

    plt.figure(figsize=(12, 6))
    ax = plt.gca()
    bars = ax.bar(df_filtered['Correlation'], df_filtered['MAPE'], color=bar_colors,
                  yerr=df_filtered['SD'] * scale_factor_for_sd, capsize=5)

    plt.xticks(rotation=45, ha='right')

    ax.set_title(f'MAPE and Scaled SD for Different Correlations ({GVC_Range} GVC)')
    ax.set_xlabel('Correlation')
    ax.set_ylabel('MAPE (%)', color='C0')

    ax.tick_params(axis='y', labelcolor='C0')

    num_test_points = df_GVC[df_GVC['GVC range'] == GVC_Range].shape[0]

    GVC_min_range = df_GVC[df_GVC['GVC range'] == GVC_Range]['GVC'].min()
    GVC_max_range = df_GVC[df_GVC['GVC range'] == GVC_Range]['GVC'].max()

    ax.text(0.01, 0.95, f"Test points: {num_test_points}", transform=ax.transAxes, fontsize=12, verticalalignment='top')
    ax.text(0.01, 0.90, f"GVC Span: {GVC_min_range:.1f} - {GVC_max_range:.1f} [cp]",
            transform=ax.transAxes, fontsize=12, verticalalignment='top')

    for label in ax.get_xticklabels():
        if label.get_text() == str(best_case_correlation) or label.get_text() == str(worst_case_correlation):
            label.set_fontweight('bold')

    plt.tight_layout()
    plt.show()
## Covariance matrix - 1
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

selected_columns = [
    "Gauge depth", "Gauge TVD", "Gauge pressure", "tubing head P", "tubing head T",
    'Relative error',"water_cut",
    "Pressure", "Temperature", "Holdup",
     "diameter", "oil density", "gas density", "water density",
]

numeric_df = raw_df[selected_columns]

cov_matrix = numeric_df.cov()

plt.figure(figsize=(15, 12))
sns.heatmap(cov_matrix, annot=True, fmt='.1f', cmap='coolwarm', xticklabels=selected_columns, yticklabels=selected_columns)
plt.xticks(rotation=45)  
plt.tight_layout()
plt.show()
## Covariance matrix - Relative error 1
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns


selected_columns = [
    "Gauge depth", "Gauge TVD", "Gauge pressure", "tubing head P", "tubing head T",
    'Relative error', "water_cut",
    "Pressure", "Temperature", "Holdup",
    "diameter", "oil density", "gas density", "water density",
]

numeric_df = raw_df[selected_columns]

cov_matrix = numeric_df.cov()

mask = np.ones_like(cov_matrix, dtype=bool)
rel_error_idx = cov_matrix.columns.get_loc('Relative error')
mask[:, rel_error_idx] = False
mask[rel_error_idx, :] = False

vmin, vmax = -3.3, 20.6

plt.figure(figsize=(15, 12))
sns.heatmap(cov_matrix, annot=True, fmt='.1f', cmap='coolwarm', mask=mask,
            vmin=vmin, vmax=vmax, cbar=True,
            xticklabels=selected_columns, yticklabels=selected_columns)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
## Covariance matrix - 2
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

selected_columns = [
     "Gauge pressure", "tubing head P", "tubing head T", "water_cut", "Reservoir_pressure", 
    "Temperature", "Holdup", "dp_gravity", "diameter", "oil density", 
    "gas density", "water density", "liquid density", "oil viscosity", 
    "WH oil viscosity", "gas viscosity", "WH gas viscosity"
]

numeric_df = raw_df[selected_columns]

cov_matrix = numeric_df.cov()

plt.figure(figsize=(15, 12))
sns.heatmap(cov_matrix, annot=True, fmt='.1f', cmap='coolwarm', 
            xticklabels=selected_columns, yticklabels=selected_columns)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
## Covariance matrix - Relative error 2
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

selected_columns = [
    "Gauge depth", "tubing head P", "tubing head T", "GOR",
    "CGR", "WGR", "Gas rate", "SGOR", "water_cut", "liquid_rate", "Reservoir_pressure", 
     "Holdup", "dp_friction", "dp_gravity", "diameter",
    "oil density", "gas density", "water density", 
    "oil viscosity",  "gas viscosity",  'Relative error'
]

numeric_df = raw_df[selected_columns]

cov_matrix = numeric_df.cov()

mask = np.ones_like(cov_matrix, dtype=bool)
rel_error_idx = cov_matrix.columns.get_loc('Relative error')
mask[:, rel_error_idx] = False
mask[rel_error_idx, :] = False

vmin, vmax = -35.5, 21.7
plt.figure(figsize=(20, 12))

sns.heatmap(cov_matrix, annot=True, fmt='.1f', cmap='RdBu', mask=mask,
            vmin=-7, vmax=7, cbar=True,center=0,
            xticklabels=selected_columns, yticklabels=selected_columns, square=True)

plt.xticks(rotation=45, ha='right')
plt.subplots_adjust(bottom=0.05)

plt.show()
## Overestimation vs Underestimation

import pandas as pd



def estimate_status(pressure, gauge_pressure):
    return 'Overestimation' if pressure > gauge_pressure else 'Underestimation'

raw_df['Estimation Status'] = raw_df.apply(lambda row: estimate_status(row['Pressure'], row['Gauge pressure']), axis=1)

correlation_list=['Duns and Ross Modified', 'Hagedorn and Brown', 'Fancher and Brown', 'Mukerjee - Brill',
 'Beggs and Brill', 'Petroleum Experts', 'Orkizewski', 'Petroleum Experts 2', 'Duns and Ross Original', 
 'Petroleum Experts 3', 'GRE (Modified by PE)', 'Petroleum Experts 4', 'Hydro 3P', 'Petroleum Experts 5', 
 'Hydro-2P', 'PE 5 (Extended)', 'OLGAS 2P', 'OLGAS 3P', 'OLGAS3P EXT']


percentage_data = []

for correlation in correlation_list:
    subset = raw_df[raw_df['Correlation'] == correlation]
    
    if subset.empty:
        percentage_data.append({'Correlation': correlation, 'Overestimation %': None, 'Underestimation %': None})
        continue
    
    overestimation_count = (subset['Estimation Status'] == 'Overestimation').sum()
    underestimation_count = (subset['Estimation Status'] == 'Underestimation').sum()
    
    total_count = len(subset)
    overestimation_percentage = (overestimation_count / total_count) * 100 if total_count > 0 else 0
    underestimation_percentage = (underestimation_count / total_count) * 100 if total_count > 0 else 0
    
    percentage_data.append({
        'Correlation': correlation,
        'Overestimation %': overestimation_percentage,
        'Underestimation %': underestimation_percentage
    })

percentage_df = pd.DataFrame(percentage_data)

print(percentage_df)

## Overestimation vs Underestimation - Plot
import numpy as np
import matplotlib.pyplot as plt

bar_width = 0.8
overest_heights = percentage_df['Overestimation %'] 
underest_heights = 100 - overest_heights  
bar_positions = np.arange(len(percentage_df))

plt.figure(figsize=(10, 8))

bars_overestimation = plt.bar(bar_positions, overest_heights, bar_width, color='#B22222', label='Overestimation Percentage')

bars_underestimation = plt.bar(bar_positions, underest_heights, bar_width, bottom=overest_heights, color='#4682B4', label='Underestimation Percentage')

plt.xticks(bar_positions, percentage_df['Correlation'].astype(str), rotation=90, ha="right")

plt.title('Over/Under-estimation distribution')
plt.xlabel('Correlation')
plt.ylabel('Percentage (%)')

plt.legend()

plt.tight_layout()

plt.show()
